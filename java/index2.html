<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD com PHP, AJAX e jQuery</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Spinner */
        #spinner {
            display: none;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
        $(document).ready(function() {
            function showSpinner() {
                $('#spinner').show();
            }

            function hideSpinner() {
                $('#spinner').hide();
            }

            function loadProducts() {
                showSpinner(); // Mostrar o spinner
                $.ajax({
                    url: 'fetch_products.php',
                    method: 'GET',
                    dataType: 'xml',
                    success: function(data) {
                        hideSpinner(); // Esconder o spinner quando o carregamento estiver completo
                        var xmlString = new XMLSerializer().serializeToString(data);
                        alert('XML Response: ' + xmlString);

                        var html = '';
                        $(data).find('produto').each(function() {
                            var id_produto = $(this).find('id_produto').text();
                            var descr_produto = $(this).find('descr_produto').text();
                            var valor = $(this).find('valor').text();
                            html += '<tr>';
                            html += '<td>' + id_produto + '</td>';
                            html += '<td>' + descr_produto + '</td>';
                            html += '<td>' + valor + '</td>';
                            html += '</tr>';
                        });
                        $('#productTable tbody').html(html);
                    },
                    error: function() {
                        hideSpinner(); // Esconder o spinner em caso de erro
                        alert('Erro ao carregar produtos.');
                    }
                });
            }

            $('#addProductForm').on('submit', function(event) {
                event.preventDefault();
                showSpinner(); // Mostrar o spinner durante a adição do produto
                $.ajax({
                    url: 'add_product.php',
                    method: 'POST',
                    data: $(this).serialize(),
                    dataType: 'xml',
                    success: function(data) {
                        hideSpinner(); // Esconder o spinner após o sucesso
                        var success = $(data).find('success').text();
                        if (success === 'true') {
                            loadProducts();
                            $('#addProductForm')[0].reset();
                        } else {
                            alert('Erro ao adicionar produto.');
                        }
                    },
                    error: function() {
                        hideSpinner(); // Esconder o spinner em caso de erro
                        alert('Erro ao adicionar produto.');
                    }
                });
            });

            loadProducts();
        });
    </script>
</head>
<body>
    <h1>Gerenciar Produtos</h1>

    <!-- Spinner de carregamento -->
    <div id="spinner"></div>

    <form id="addProductForm">
        <label for="descr_produto">Descrição:</label>
        <input type="text" id="descr_produto" name="descr_produto" required>
        <label for="valor">Valor:</label>
        <input type="text" id="valor" name="valor" required>
        <button type="submit">Adicionar Produto</button>
    </form>

    <h2>Lista de Produtos</h2>
    <table id="productTable" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Descrição</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dados serão carregados aqui -->
        </tbody>
    </table>
</body>
</html>

