<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD com PHP, AJAX e jQuery</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            function loadProducts() {
                $.ajax({
                    url: 'fetch_products.php',
                    method: 'GET',
                    dataType: 'xml',
                    
                    success: function(data) {
                     // Exibir o XML como uma string
                     var xmlString = new XMLSerializer().serializeToString(data);
                     alert('XML Response: ' + xmlString);
                        
                        var html = '';
                        $(data).find('produto').each(function() {
                            var id_produto = $(this).find('id_produto').text();
                            var descr_produto = $(this).find('descr_produto').text();
                            var valor = $(this).find('valor').text();
                            html += '<tr>';
                            html += '<td>' + id_produto + '</td>';
                            html += '<td>' + descr_produto + '</td>';
                            html += '<td>' + valor + '</td>';
                            html += '</tr>';
                        });
                        $('#productTable tbody').html(html);
                    },
                    error: function() {
                        alert('Erro ao carregar produtos.');
                    }
                });
            }

            $('#addProductForm').on('submit', function(event) {
                event.preventDefault();
                $.ajax({
                    url: 'add_product.php',
                    method: 'POST',
                    data: $(this).serialize(),
                    dataType: 'xml',
                    success: function(data) {
                        var success = $(data).find('success').text();
                        if (success === 'true') {
                            loadProducts();
                            $('#addProductForm')[0].reset();
                        } else {
                            alert('Erro ao adicionar produto.');
                        }
                    },
                    error: function() {
                        alert('Erro ao adicionar produto.');
                    }
                });
            });

            loadProducts();
        });
    </script>
</head>
<body>
    <h1>Gerenciar Produtos</h1>
    <form id="addProductForm">
        <label for="descr_produto">Descrição:</label>
        <input type="text" id="descr_produto" name="descr_produto" required>
        <label for="valor">Valor:</label>
        <input type="text" id="valor" name="valor" required>
        <button type="submit">Adicionar Produto</button>
    </form>

    <h2>Lista de Produtos</h2>
    <table id="productTable" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Descrição</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dados serão carregados aqui -->
        </tbody>
    </table>
</body>
</html>
